kind: pipeline
type: exec
name: default

platform:
  os: windows
  # arch: amd64
  # version: "1809"

steps:
  - name: build
    # image: mcr.microsoft.com/dotnet/framework/sdk:4.8
    commands:
      - powershell
      #
      # - curl.exe -o nuget.exe https://dist.nuget.org/win-x86-commandline/latest/nuget.exe
      - nuget.exe restore WebApplication1.sln
      #
      - msbuild "WebApplication1\WebApplication1.csproj" /p:Configuration=Release -r:False /p:DeployOnBuild=True /p:DeployDefaultTarget=WebPublish /p:WebPublishMethod=FileSystem /p:DeleteExistingFiles=True /p:publishUrl=../output
      - ls ./output
      - pwd

  - name: docker-build
    # image: docker:dind
    commands:
      - powershell
      - pwd
      - ls ./output
      - docker info
      - cp -r ./output ./devops/wwwroot
      - cd ./devops
      - ./build.ps1

  # - name: github-release
  #   image: plugins/github-release
  #   settings:
  #     api_key: xxxxxxxx
  #     files: dist/*
# ---
# kind: pipeline
# type: ssh
# name: docker

# platform:
#   os: windows

# server:
#   host:
#     from_secret: windows_host
#   password:
#     from_secret: windows_password
#   user:
#     from_secret: windows_username

# steps:
#   - name: build
#     environment:
#       VERSION: 1809
#       # USERNAME:
#       #   from_secret: docker_username
#       # PASSWORD:
#       #   from_secret: docker_password
#     commands:
#       - dir
#       - pwsh.exe "cp ./output ./devops/wwwroot"
#       - pwsh.exe devops/build.ps1

# depends_on:
#   - source
